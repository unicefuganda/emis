{% load stats_extras %}
<form id="date_range_form" method="POST">
{% csrf_token %}
<p>Date Range:<span id="date_slider_value" class="daterange">From {{ start_date|date:"Y-m-d" }} to {{ end_date|date:"Y-m-d" }}</span>
<a href="javascript:void(0)" onclick="previous_date_range('w');"> &laquo; previous week</a> |
<a href="javascript:void(0)" onclick="previous_date_range('m');"> &laquo; previous month</a>
<a href="javascript:void(0)" onclick="document.forms[0].submit()" style="float:right">update</a>
{{ date_range_form }}

<div id="date_slider" style="margin: 5px 5px 80px 5px">
    <form action="#">
       {% date_range  min_ts max_ts start_ts end_ts%}
       </form>

</div>
<script language="javascript">
$(function(){


    //initialise ui slider
	$('select#start, select#end').selectToUISlider({
        labels: 0,

		sliderOptions: {
		change:function(e, ui) {
		start_date=new Date(parseInt($('select#start option').eq(ui.values[0])[0].value));
        start_str = start_date.getDate() + "-" + (start_date.getMonth() + 1) + "-" + start_date.getFullYear();
		end_date=new Date(parseInt($('select#end option').eq(ui.values[1])[0].value));
        end_str = end_date.getDate() + "-" + (end_date.getMonth() + 1) + "-" + end_date.getFullYear();
        $('#id_start_ts').val(parseInt($('select#start option').eq(ui.values[0])[0].value));
        $('#id_end_ts').val(parseInt($('select#end option').eq(ui.values[1])[0].value));
        $( "#date_slider_value" ).text( "From " + start_str + " to " + end_str );



	}}
	});
	var min_timestamp = {{ min_ts }};
	var min_sdt = new Date(min_timestamp);
	if(min_sdt.getDay() !== 1){
		offset = 7 - min_sdt.getDay();
	}else{
		offset = 0;

	}
    tickEvery(7, offset);

    start_date = new Date({{ start_ts }});
    start_str = start_date.getDate() + "-" + (start_date.getMonth() + 1) + "-" + start_date.getFullYear();
    end_date = new Date({{ end_ts }});
    end_str = end_date.getDate() + "-" + (end_date.getMonth() + 1) + "-" + end_date.getFullYear();
    $('#id_start_ts').val('' + {{ start_ts }});
    $('#id_end_ts').val('' + {{ end_ts }});
    $( "#date_slider_value" ).text( "From " + start_str +
        " to " + end_str );

});


</script>